

!function(a){function b(a,b){this.element=a,this.options=b,this.items=this.options.items.slice(),this.filteredItems=this.items.slice(),this.init(),this.bindEvents(),this.options.paging===!1?this.updateList():(this.currentPage=0,this.loading=!1,this.allItemsLoaded=!1,this.debounce=null,this.loadPage(0))}b.prototype.init=function(){if("INPUT"!==this.element[0].nodeName)throw"Rich Autocomplete - Expected <input> but instead got <"+this.element[0].nodeName.toLowerCase()+">";this.element.wrap('<div class="rich-autocomplete"></div>'),this.list=a('<ul class="rich-autocomplete-list"></ul>'),this.list.css("max-height",this.options.maxHeight+"px"),this.list.hide(),this.container=this.element.parent(),this.container.append(this.list);var b='<div class="spinner-container">';b+='<div class="spinner">',b+='<div class="spinner-node node1"></div>',b+='<div class="spinner-node node2"></div>',b+='<div class="spinner-node node3"></div>',b+='<div class="spinner-node node4"></div>',b+='<div class="spinner-node node5"></div>',b+='<div class="spinner-node node6"></div>',b+='<div class="spinner-node node7"></div>',b+='<div class="spinner-node node8"></div>',b+="</div>",b+="</div>",this.spinner=a(b),this.spinner.hide(),this.container.append(this.spinner)},b.prototype.bindEvents=function(){var a=this;this.element.focus(function(b){a.showList.apply(a,[b])}),this.element.blur(function(b){a.hideList.apply(a,[b])}),this.element.keyup(function(b){38!==b.keyCode&&40!==b.keyCode&&a.filterResults.apply(a,[b])}),this.element.keydown(function(b){38===b.keyCode&&a.highlightUp.apply(a,[b]),40===b.keyCode&&a.highlightDown.apply(a,[b]),13===b.keyCode&&a.selectHighlighted.apply(a,[b])}),this.list.scroll(function(b){if(a.options.paging!==!1&&a.loading!==!0&&a.allItemsLoaded!==!0){var c=a.list.scrollTop(),d=a.list.height(),e=c+d,f=a.list[0].scrollHeight-20;e>f&&a.loadNextPage.apply(a)}})},b.prototype.showList=function(){this.list.show()},b.prototype.hideList=function(a){this.list.hide(),this.list.find(".highlighted").removeClass("highlighted")},b.prototype.filterResults=function(a){var b=this,c=this.element.val();this.options.paging===!1?(this.filteredItems=this.options.filter(this.items,c),this.updateList()):(this.debounce&&clearTimeout(this.debounce),this.debounce=setTimeout(function(){b.currentPage=0,b.allItemsLoaded=!1,b.loading=!1,b.spinner.hide(),b.loadPage(0)},""===c?0:this.options.debounce))},b.prototype.loadPage=function(a){var b=this;if(this.loading!==!0&&(0===a||this.allItemsLoaded!==!0)){this.loading=!0,this.options.showSpinner&&this.spinner.show(),0===a&&(this.filteredItems=[],this.allItemsLoaded=!1);var c=this.element.val(),d=this.options.loadPage(c,a,this.options.pageSize);d.promise?d.done(function(a){b.filteredItems=b.filteredItems.concat(a),b.updateDynamicList.apply(b),b.spinner.hide(),b.loading=!1,(0===a.length||a.length<b.pageSize)&&(b.allItemsLoaded=!0)}):(this.filteredItems=this.filteredItems.concat(d),this.updateDynamicList(),this.spinner.hide(),this.loading=!1,(0===d.length||d.length<this.pageSize)&&(this.allItemsLoaded=!0))}},b.prototype.loadNextPage=function(){this.loading!==!0&&this.allItemsLoaded!==!0&&this.loadPage(++this.currentPage)},b.prototype.updateDynamicList=function(){var b=this.list.find(".highlighted").first().data("item-data");if(this.updateList(),b){var c=this.list.find(".rich-autocomplete-list-item");c.each(function(c,d){var e=a(d).data("item-data");return e===b?(a(d).addClass("highlighted"),!1):void 0})}},b.prototype.updateList=function(){var b=this;if(this.list.empty(),0===this.filteredItems.length){var c=a('<li class="rich-autocomplete-list-item-empty"></li>');return c.append(a(this.options.emptyRender())),void this.list.append(c)}for(var d=function(c){var d=a(this).data("item-data");b.selectItem.apply(b,[d])},e=function(c){b.hoverItem.apply(b,[a(this)])},f=function(c){b.unhoverItem.apply(b,[a(this)])},g=0;g<this.filteredItems.length;g++){var h=a('<li class="rich-autocomplete-list-item" index="'+g+'"></li>');h.append(a(this.options.render(this.filteredItems[g]))),h.data("item-data",this.filteredItems[g]),h.mousedown(d),h.mouseover(e),h.mouseout(f),this.list.append(h)}},b.prototype.hoverItem=function(a){this.list.find(".highlighted").removeClass("highlighted"),a.addClass("highlighted")},b.prototype.unhoverItem=function(a){a.removeClass("highlighted")},b.prototype.selectItem=function(a){var b=this.options.extractText(a);this.element.val(b),this.options.select(a),this.filterResults()},b.prototype.selectHighlighted=function(){var a=this.list.find(".highlighted");if(0!==a.length){var b=a.first().data("item-data");this.selectItem(b),this.hideList()}},b.prototype.highlightUp=function(){var a=this.list.find(".highlighted");if(0===a.length)this.hideList();else if(this.listVisible()&&this.filteredItems.length>0){var b=this.list.find(".rich-autocomplete-list-item"),c=+a.first().attr("index"),d=+b.first().attr("index");if(c>d){var e=a.first().prev(".rich-autocomplete-list-item");if(0===e.length)return;a.removeClass("highlighted"),e.addClass("highlighted");var f=this.list.height(),g=this.list.scrollTop(),h=g+f,i=e.position().top+g,j=i+e.outerHeight();j>=h?this.list.scrollTop(j-f>0?j-f:0):g>i&&this.list.scrollTop(i)}else c===d&&this.hideList()}},b.prototype.highlightDown=function(){var a,b,c,d,e,f=this.list.find(".highlighted");if(0===f.length){this.listVisible()||this.showList();this.list.find(".rich-autocomplete-list-item").first().addClass("highlighted");this.list.scrollTop(0)}else if(this.listVisible()){var h=this.list.find(".rich-autocomplete-list-item"),i=+f.first().attr("index"),j=+h.last().attr("index");if(j>i){var k=f.first().next(".rich-autocomplete-list-item");if(0===k.length)return;f.removeClass("highlighted"),k.addClass("highlighted"),a=this.list.height(),b=this.list.scrollTop(),c=b+a,d=k.position().top+b,e=d+k.outerHeight(),e>=c?this.list.scrollTop(e-a>0?e-a:0):b>d&&this.list.scrollTop(d)}}},b.prototype.listVisible=function(){return"none"!==this.list[0].style.display},a.fn.richAutocomplete=function(c){var d={maxHeight:200,items:[],paging:!1,pageSize:0,showSpinner:!0,debounce:500,extractText:function(a){return a},filter:function(a,b){return a.filter(function(a){return-1!==a.toLowerCase().indexOf(b.toLowerCase())})},render:function(a){return"<p>"+a+"</p>"},emptyRender:function(){return"<p>No Matches Found...</p>"},select:function(a){},loadPage:function(a,b){return[]}};c=a.extend(d,c),a(this).data("rich-autocomplete",new b(this,c))}}(jQuery);